# üìò Application Configuration Guide

This guide explains how to manage and load configuration for the **Userverse** backend API. Configuration can be supplied through two sources:

1. `pyproject.toml` (preferred)
2. `sample-config.json` (fallback)

---

## üîß Configuration Loader

The app uses a flexible `ConfigLoader` class that allows selecting a configuration source. If no source is specified, it attempts to load from `pyproject.toml`, and falls back to JSON if unavailable.

### ‚úÖ Usage

```python
from config_loader import ConfigLoader

loader = ConfigLoader(source="toml")  # or "json"
config = loader.load()
```

---

## 1Ô∏è‚É£ `pyproject.toml` Format (Recommended)

Place your configuration under `[tool.userverse.config]`:

```toml
[tool.userverse.config]
environment = "production"
version = "1.0.0"
name = "Userverse"
description = "Userverse backend API"

[tool.userverse.config.database]
development = "sqlite:///dev.db"
production = "postgresql://user:pass@host:port/dbname"

[tool.userverse.config.jwt]
secret_key = "supersecret"
algorithm = "HS256"

[tool.userverse.config.email]
smtp_host = "smtp.mailserver.com"
smtp_port = 587
username = "no-reply@domain.com"
password = "emailpassword"

[tool.userverse.config.cor_origins]
allowed = ["https://yourdomain.com"]
blocked = ["http://localhost:3000"]
```

---

## 2Ô∏è‚É£ `sample-config.json` Format (Fallback)

A simplified JSON alternative with the same structure:

```json
{
  "environment": "development",
  "version": "1.0.0",
  "name": "Userverse",
  "description": "Userverse backend API",
  "database": {
    "development": "sqlite:///dev.db",
    "production": "postgresql://user:pass@host/db"
  },
  "jwt": {
    "secret_key": "supersecret",
    "algorithm": "HS256"
  },
  "email": {
    "smtp_host": "smtp.mailserver.com",
    "smtp_port": 587,
    "username": "no-reply@domain.com",
    "password": "emailpassword"
  },
  "cor_origins": {
    "allowed": ["https://yourdomain.com"],
    "blocked": ["http://localhost:3000"]
  }
}
```

---

# Userverse Project: Database Setup and Model Integration Guide

## Configure the Database

Ensure that the `sqlalchemy.url` in your `alembic.ini` file is correctly configured to point to your PostgreSQL database. Example:

```ini
sqlalchemy.url = postgresql://user:password@host:port/database_name
```

## Applying Database Changes (Migrations)

### 1. Fetch the Latest Changes

Before applying any migrations, make sure you have the latest changes from the repository:

```bash
git pull origin main
```

### 2. Apply Migrations

Use Alembic to apply the latest database migrations:

```bash
alembic upgrade head
```

This command will bring your database schema up to date with the latest changes defined in the migration scripts.

### 3. Verify the Changes

Connect to your database using a tool like `psql` or pgAdmin and verify that the database schema has been updated as expected.

## Adding New Application Models

### 1. Create the Model File

Create a new Python file (e.g., `app/database/new_model.py`) to define your new SQLAlchemy model.

### 2. Define the Model

Define your model class, inheriting from `BaseModel` (or your base model class):

```python
from sqlalchemy import Column, Integer, String
from app.database.base_model import BaseModel

class NewModel(BaseModel):
    __tablename__ = "new_model"

    id = Column(Integer, primary_key=True)
    name = Column(String(255))

    def __repr__(self):
        return f"<NewModel(name='{self.name}')>"
```

### 3. Import the Model

Import the new model in your `alembic/env.py` file to ensure Alembic is aware of it:

```python
import sys
import os

sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), "..")))

from app.database.base_model import BaseModel
from app.database.user import User
from app.database.company import Company
from app.database.association_user_company import AssociationUserCompany
from app.database.new_model import NewModel  # Import the new model here

target_metadata = BaseModel.metadata
```

### 4. Generate a Migration

Generate a new Alembic migration to create the table in the database:

```bash
alembic revision --autogenerate -m "Add new_model table"
```

### 5. Apply the Migration

Apply the generated migration to update the database schema:

```bash
alembic upgrade head
```

## Best Practices

- Always create a virtual environment to manage project dependencies.
- Keep your database connection details secure and avoid committing them to version control.
- Test migrations in a development environment before applying them to production.
- Review autogenerated migrations to ensure they accurately reflect the intended changes.
- Commit your model definitions and migration scripts to version control.

---

**By following these steps, you can easily configure your database, apply schema changes, and add new models to the Userverse project.**